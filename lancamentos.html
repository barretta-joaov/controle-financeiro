
<script>
  const arduinoID = "arduino1";

  document.querySelectorAll('.led-btn').forEach(button => {
    const imgSrc = button.getAttribute('data-img');
    if (imgSrc) {
      button.style.backgroundImage = `url('${imgSrc}')`;
    }
  });

  function sendCommand(pin, action) {
    fetch(`/arduino/${arduinoID}/${action}/${pin}`)
      .then(response => response.text())
      .then(data => console.log(data))
      .catch(error => console.error('Erro ao enviar comando:', error));
  }

  function updateButtonStates() {
    fetch(`/estado/${arduinoID}`)
      .then(response => response.json())
      .then(states => {
        document.querySelectorAll('.led-btn').forEach(button => {
          const pin = button.getAttribute('data-pin');
          const isOn = states[pin] === 'on';
          button.classList.toggle('active', isOn);
        });
      })
      .catch(error => console.error('Erro ao carregar estados:', error));
  }

  function sendAllCommand(action) {
    const buttons = document.querySelectorAll('.led-btn');
    buttons.forEach(button => {
      const pin = button.getAttribute('data-pin');
      fetch(`/arduino/${arduinoID}/${action}/${pin}`)
        .then(response => response.text())
        .then(() => {
          button.classList.toggle('active', action === 'ligar');
        })
        .catch(error => console.error(`Erro ao ${action} pino ${pin}:`, error));
    });
  }

  document.querySelectorAll('.led-btn').forEach(button => {
    button.addEventListener('click', () => {
      const pin = button.getAttribute('data-pin');
      const isActive = button.classList.contains('active');
      const action = isActive ? 'desligar' : 'ligar';
      sendCommand(pin, action);
      button.classList.toggle('active', !isActive);
    });
  });

  document.getElementById('all-on').addEventListener('click', () => sendAllCommand('ligar'));
  document.getElementById('all-off').addEventListener('click', () => sendAllCommand('desligar'));

  window.onload = updateButtonStates;
</script>
